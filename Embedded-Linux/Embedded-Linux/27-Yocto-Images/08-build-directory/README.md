
# OpenEmbedded Build Directory Structure

This README provides an in-depth overview of the directory structure and key files created by the OpenEmbedded build system when you run the `oe-init-build-env` setup script. This is particularly relevant when working within the Yocto Project environment.

## Table of Contents

1. [Introduction](#introduction)
2. [Top-Level Build Directory](#top-level-build-directory)
3. [Key Subdirectories](#key-subdirectories)
   - [Build History (`build/buildhistory/`)](#build-history-buildbuildhistory)
   - [Cache (`build/cache/`)](#cache-buildcache)
   - [Configuration Files (`build/conf/`)](#configuration-files-buildconf)
     - [`local.conf`](#localconf)
     - [`bblayers.conf`](#bblayersconf)
   - [Downloads (`build/downloads/`)](#downloads-builddownloads)
   - [Shared State Cache (`build/sstate-cache/`)](#shared-state-cache-buildsstate-cache)
   - [Temporary Directory (`build/tmp/`)](#temporary-directory-buildtmp)
     - [Build Statistics (`build/tmp/buildstats/`)](#build-statistics-buildtmpbuildstats)
     - [Cache (`build/tmp/cache/`)](#cache-buildtmpcache)
     - [Deployment (`build/tmp/deploy/`)](#deployment-buildtmpdeploy)
     - [Work Directory (`build/tmp/work/`)](#work-directory-buildtmpwork)
4. [Conclusion](#conclusion)

## Introduction

The OpenEmbedded build system, used within the Yocto Project, generates a comprehensive directory structure to manage the build process. This document outlines the purpose and contents of each key directory and file within the build directory, helping you navigate and understand the build environment.

## Top-Level Build Directory

When you set up your build environment using the `oe-init-build-env` script, the system creates the Build Directory. By default, this directory is named `build/`, but you can specify a different name during setup. The build directory's name is stored in the `TOPDIR` variable for use during subsequent processing.

## Key Subdirectories

### Build History (`build/buildhistory/`)

The `build/buildhistory/` directory is created when you enable build history using the `buildhistory` class. It organizes build information into subdirectories for images, packages, and SDKs. This feature helps maintain build output quality and provides a historical record of builds.

### Cache (`build/cache/`)

The `build/cache/` directory contains internal files used by the build system, including the `sanity_info` file, which tracks important build information like `TMPDIR`, `SSTATE_DIR`, and the host distribution's name and version.

### Configuration Files (`build/conf/`)

#### `local.conf`

The `local.conf` file holds local user configurations for the build environment. It is the primary file for setting up variables like `MACHINE`, `PACKAGE_CLASSES`, and `DL_DIR`. If this file is not present, it is generated from `local.conf.sample` when you run `oe-init-build-env`.

#### `bblayers.conf`

The `bblayers.conf` file lists the layers that BitBake will process, defined by the `BBLAYERS` variable. Like `local.conf`, it is generated from a sample file (`bblayers.conf.sample`) if not already present.

### Downloads (`build/downloads/`)

This directory contains the source tarballs downloaded during the build process. You can reuse this directory across multiple builds or move it to another location, controlled by the `DL_DIR` variable.

### Shared State Cache (`build/sstate-cache/`)

The `build/sstate-cache/` directory stores the shared state cache, which can be reused across multiple builds to speed up the process. The location of this directory is controlled by the `SSTATE_DIR` variable.

### Temporary Directory (`build/tmp/`)

The `build/tmp/` directory is the primary output directory for the build process, containing several important subdirectories:

#### Build Statistics (`build/tmp/buildstats/`)

Stores build statistics generated by the `buildstats` class.

#### Cache (`build/tmp/cache/`)

Contains cached metadata results from BitBake to speed up subsequent builds.

#### Deployment (`build/tmp/deploy/`)

Holds the final output artifacts, such as images, packages, and SDKs. Key subdirectories include:
- **`deploy/deb/`**: `.deb` packages
- **`deploy/rpm/`**: `.rpm` packages
- **`deploy/ipk/`**: `.ipk` packages
- **`deploy/licenses/`**: Licensing information
- **`deploy/images/`**: Generated build artifacts, including bootloader images, kernel, and root filesystem.
- **`deploy/sdk/`**: Toolchain installer scripts for the target hardware.

#### Work Directory (`build/tmp/work/`)

The `work/` directory contains architecture-specific subdirectories where the build tasks are executed. Each recipe has its own work directory, which includes:
- **`temp/`**: Logs and scripts for each task.
- **`image/`**: Output from the `do_install` task.
- **`package/`**: Output from the `do_package` task.
- **`packages-split/`**: Individual packages created by the recipe.
- **`recipe-sysroot/`**: Target dependencies of the recipe.
- **`recipe-sysroot-native/`**: Native dependencies of the recipe.
- **`build/`**: Separate build artifacts for recipes that support out-of-source builds.

### Other Notable Directories

- **`build/tmp/sstate-control/`**: Manages shared state manifest files.
- **`build/tmp/sysroots-components/`**: Holds sysroot contents for recipes listed in `DEPENDS`.
- **`build/tmp/stamps/`**: Tracks which tasks have run and when.
- **`build/tmp/log/`**: General logs not associated with specific packages.
- **`build/tmp/work-shared/`**: Used for recipes that share work directories with others, typically for GCC and its variants.

## Conclusion

Understanding the structure of the OpenEmbedded build directory is crucial for efficiently managing and troubleshooting your build environment. This README serves as a comprehensive guide to help you navigate the various directories and files, ensuring you can make the most of your development with the Yocto Project.

