

## Configuring and Compiling with CMake in Yocto

When working with CMake in Yocto, you need to properly configure the build paths and manage the compilation process. Here's a guide on how to do this using the `do_configure()` and `do_compile()` functions in your Bitbake recipe.

### 1. Configuring the Build: `do_configure()`

The `do_configure()` function is where you run the CMake configuration command. In a typical CMake project, you might run:

```bash
cmake -S . -B build
```

This command specifies the source directory (`-S .`) and the build directory (`-B build`). In Yocto, you need to adjust these paths to fit the Yocto environment:

```bash
do_configure() {
    cmake -S ${S} -B ${B}
}
```

- **`${S}`**: The source directory, where your code is located after being fetched and unpacked.
- **`${B}`**: The build directory, where CMake will generate its build files, including the Makefile.

### 2. Compiling the Code: `do_compile()`

After configuring the build with CMake, you need to compile the code. Normally, you would use `make` to compile the project based on the Makefile generated by CMake. In Yocto, the `do_compile()` function can look like this:

```bash
do_compile() {
    cmake --build ${B}
}
```

Here, `cmake --build ${B}` is used instead of `make`, as itâ€™s more portable and directly utilizes the CMake build system.

### 3. Installing the Executable: `do_install()`

Once the code is compiled, you need to install the executable to the appropriate location in the Yocto file system, typically under `/usr/bin`. The `do_install()` function handles this:

```bash
do_install() {
    mkdir -p ${D}/usr/bin
    cp ${B}/myapp ${D}/usr/bin/
}
```

This ensures that the compiled executable is placed in the correct directory within the Yocto root filesystem, which in your case is:

```bash
~/yocto/poky/build/tmp/work/cortexa57-poky-linux/mina/1.0-r0/<recipe>/image/usr/bin
```

### Summary

- **`do_configure()`**: Configures the build using CMake and specifies the source and build directories.
- **`do_compile()`**: Compiles the code using the build files generated by CMake.
- **`do_install()`**: Installs the compiled executable to the target filesystem.

By correctly setting up these functions, you can seamlessly integrate CMake-based projects into the Yocto build system.

---

This section explains how to configure and compile projects using CMake within a Yocto environment, with a focus on path management and using the Makefile generated by CMake.